<project default="site:generate"
    xmlns:doc="doc"
    xmlns:maven="jelly:maven"
    xmlns:j="jelly:core"
    xmlns:util="jelly:util"
    xmlns:ant="jelly:ant">

    <preGoal name="xdoc:copy-user-resources">
        <ant:mkdir dir="${basedir}/xdocs/style"/>
        <ant:copy file="${basedir}/../tools/site/project.css"
                  todir="${basedir}/xdocs/style"/>
    </preGoal>

    <preGoal name="xdoc:transform">
        <attainGoal name="generateNavigation"/>
        <ant:copy file="${basedir}/../tools/site/site.jsl" todir="target"/>
    </preGoal>

    <goal name="generateNavigation">
        <mkdir dir="target"/>
        <j:file name="target/navigation.xml" prettyPrint="true">
            <naproject name="Spice" href="spice.sourceforge.net">
                <title>Spice</title>
                    <body>
                        <links>
                            <item name="Home" href="/index.html"/>
                        </links>
                        <menu name="Overview">
                            <item name="Home" href="/index.html"/>
                            <item name="Downloads" href="http://sourceforge.net/project/showfiles.php?group_id=67448"/>
   		                    <ant:fileScanner var="components">
       		                    <fileset dir="${basedir}/../components">
           		                    <include name="*/project.xml"/>
               		            </fileset>
                   		    </ant:fileScanner>
   		                    <ant:fileScanner var="sandbox">
       		                    <fileset dir="${basedir}/../sandbox">
           		                    <include name="*/project.xml"/>
               		            </fileset>
                   		    </ant:fileScanner>
		                    <item name="Spice" href="index.html" collapse="false">
		                    	<item name="Components" href="index.html" collapse="false">
	                        		<j:forEach items="${components.iterator()}" var="component">
    	                        		<maven:pom projectDescriptor="${component}" var="cPOM"/>
                	            		<j:if test="${cPOM.groupId != 'jcomponent'}">
                    	        			<item name="${cPOM.name}"
                        	        			href="/${component.parentFile.name}/index.html"/>
                            	    	</j:if>
	                        		</j:forEach>
                        		</item>
		                    	<item name="Sandbox" href="index.html" collapse="false">
	                        		<j:forEach items="${sandbox.iterator()}" var="component">
    	                        		<maven:pom projectDescriptor="${component}" var="cPOM"/>
                	            		<j:if test="${cPOM.groupId != 'jcomponent'}">
                    	        			<item name="${cPOM.name}"
                        	        			href="/${component.parentFile.name}/index.html"/>
                            	    	</j:if>
	                        		</j:forEach>
                        		</item>
                    		</item>
		                    <item name="JComponent" href="index.html" collapse="false">
		                    	<item name="Components" href="index.html" collapse="false">
	                        		<j:forEach items="${components.iterator()}" var="component">
    	                        		<maven:pom projectDescriptor="${component}" var="cPOM"/>
                	            		<j:if test="${cPOM.groupId == 'jcomponent'}">
                    	        			<item name="${cPOM.name}"
                        	        			href="/${component.parentFile.name}/index.html"/>
                            	    	</j:if>
	                        		</j:forEach>
                        		</item>
		                    	<item name="Sandbox" href="index.html" collapse="false">
	                        		<j:forEach items="${sandbox.iterator()}" var="component">
    	                        		<maven:pom projectDescriptor="${component}" var="cPOM"/>
                	            		<j:if test="${cPOM.groupId == 'jcomponent'}">
                    	        			<item name="${cPOM.name}"
                        	        			href="/${component.parentFile.name}/index.html"/>
                            	    	</j:if>
	                        		</j:forEach>
                        		</item>
                    		</item>
                        </menu>
                    </body>
            </naproject>
        </j:file>
        <doc:jslFile
            input="target/navigation.xml"
            output="target/generated-xdocs/navigation.xml"
            stylesheet="../tools/navigation.jsl"
            omitXmlDeclaration="true"
            outputMode="xml"
            prettyPrint="true"/>
    </goal>

</project>
