<project default="site:generate"
    xmlns:doc="doc"
    xmlns:maven="jelly:maven"
    xmlns:j="jelly:core"
    xmlns:ant="jelly:ant">

    <preGoal name="xdoc:transform">
        <attainGoal name="generateNavigation"/>
    </preGoal>

    <goal name="generateNavigation">
        <mkdir dir="target"/>
        <j:file name="target/navigation.xml" prettyPrint="true">
            <naproject name="Spice" href="spice.sourceforge.net">
                <title>Spice</title>
                <body>
                    <menu name="Overview">
                        <item name="Spice Project"  href="/index.html"/>
                        <item name="Status" 		href="/status.html"/>
                        <item name="TODO"   		href="/todo.html"/>
                    </menu>

                    <menu name="Components">
                        <ant:fileScanner var="components">
                            <fileset dir="${basedir}/../components">
                                <include name="*/project.xml"/>
                            </fileset>
                        </ant:fileScanner>
                        <j:forEach items="${components.iterator()}" var="component">
                            <maven:pom projectDescriptor="${component}" var="cPOM"/>
                            <item name="${cPOM.name}"
                                href="/${component.parentFile.name}/index.html"/>
                        </j:forEach>
                    </menu>
                </body>
            </naproject>
        </j:file>
        <doc:jslFile
             input="target/navigation.xml"
             output="xdocs/navigation.xml"
             stylesheet="../tools/navigation.jsl"
             omitXmlDeclaration="true"
             outputMode="xml"
             prettyPrint="true"/>
    </goal>

    <postGoal name="site:deploy">
        <exec dir="." executable="${maven.ssh.executable}">
            <arg line="${pom.siteAddress} -l ${maven.username} 'cd ${maven.homepage};chmod -R g+u . *'"/>
        </exec>
    </postGoal>

</project>
