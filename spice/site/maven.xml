<project default="site:generate"
    xmlns:ant="jelly:ant"
    xmlns:define="jelly:define"
    xmlns:doc="doc"
    xmlns:j="jelly:core"
    xmlns:maven="jelly:maven"
    xmlns:util="jelly:util"
    xmlns:repository="spice:repository">

    <define:taglib uri="spice:repository">
        <define:tag name="generateSummary">
	        <ant:fileScanner var="components">
    	        <ant:fileset dir="${basedir}/../${type}">
      				<ant:include name="*/project.xml"/>
       			</ant:fileset>
       		</ant:fileScanner>
       		<ant:mkdir dir="target/generated-xdocs"/>
	        <j:file name="target/generated-xdocs/${type}.xml" prettyPrint="true">
				<document>
				    <properties>
    				<title>${name}</title>
				    </properties>
				    <body>
				  	<section name="${name}">
		   				<j:forEach items="${components.iterator()}" var="component">
    	       			<maven:pom projectDescriptor="${component}" var="POM"/>
                			<subsection name="${POM.name}">
                   				<p> <a href="/${component.parentFile.name}/index.html">${POM.name}</a>:
                   					${POM.description}</p>
                			</subsection>
	       				</j:forEach>
	       			</section>
		       		</body>
	       		</document>
    	    </j:file>
        </define:tag>
    </define:taglib>

    <preGoal name="xdoc:copy-user-resources">
        <ant:copy file="${basedir}/../tools/site/project.css"
                  todir="target/docs/style"/>
    </preGoal>

    <preGoal name="xdoc:transform">
        <repository:generateSummary type="components" name="Components"/>
        <repository:generateSummary type="sandbox" name="Sandbox"/>
        <ant:copy file="${basedir}/../tools/site/site.jsl" todir="target"/>
    </preGoal>

</project>
